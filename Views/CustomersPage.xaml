<Page x:Class="AuroraInvoice.Views.CustomersPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:converters="clr-namespace:AuroraInvoice.Converters"
      mc:Ignorable="d"
      d:DesignHeight="800" d:DesignWidth="1000"
      Title="Customers">

    <Page.Resources>
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
    </Page.Resources>

    <Grid Margin="40,30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="Customers"
                      Style="{StaticResource HeaderText}"/>
            <TextBlock Text="Manage your customer database"
                      Style="{StaticResource SecondaryText}"/>
        </StackPanel>

        <!-- Action Bar -->
        <Grid Grid.Row="1" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBox Grid.Column="0"
                    Style="{StaticResource ModernTextBox}"
                    Width="300"
                    HorizontalAlignment="Left"
                    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}">
                <TextBox.Tag>
                    <TextBlock Text="Search customers..."
                              Foreground="{StaticResource TextSecondaryBrush}"
                              IsHitTestVisible="False"
                              Margin="12,10"/>
                </TextBox.Tag>
            </TextBox>

            <Button Grid.Column="1"
                   Content="+ New Customer"
                   Style="{StaticResource ModernButton}"
                   Command="{Binding NewCustomerCommand}"/>
        </Grid>

        <!-- Customer List -->
        <Border Grid.Row="2" Style="{StaticResource Card}">
            <Grid>
                <DataGrid ItemsSource="{Binding Customers}"
                         Style="{StaticResource ModernDataGrid}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                        <DataGridTextColumn Header="Contact Person" Binding="{Binding ContactPerson}" Width="*"/>
                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="*"/>
                        <DataGridTextColumn Header="Phone" Binding="{Binding Phone}" Width="Auto"/>
                        <DataGridTextColumn Header="ABN" Binding="{Binding ABN}" Width="Auto"/>
                        <DataGridTemplateColumn Header="Actions" Width="Auto">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="Edit"
                                               Style="{StaticResource SecondaryButton}"
                                               Padding="8,4"
                                               Margin="0,0,5,0"
                                               Command="{Binding DataContext.EditCustomerCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                               CommandParameter="{Binding}"/>
                                        <Button Content="Delete"
                                               Style="{StaticResource SecondaryButton}"
                                               Padding="8,4"
                                               Command="{Binding DataContext.DeleteCustomerCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                               CommandParameter="{Binding}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Empty State -->
                <StackPanel VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Visibility="{Binding Customers.Count, Converter={StaticResource CountToVisibilityConverter}}">
                    <TextBlock Text="No customers yet"
                              FontSize="18"
                              FontWeight="SemiBold"
                              Foreground="{StaticResource TextSecondaryBrush}"
                              HorizontalAlignment="Center"/>
                    <TextBlock Text="Click 'New Customer' to add your first customer"
                              FontSize="14"
                              Foreground="{StaticResource TextSecondaryBrush}"
                              HorizontalAlignment="Center"
                              Margin="0,8,0,0"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>